{% extends "base.html" %}
{% load asistencia_tags %}
{% block content %}
<div class="container">
    <div class="list-header">
        <div>
            <h2>Gestión de Asistencia</h2>
            <p style="margin:0; font-size: 1.2em; color: #555;"><strong>{{ curso.materia.nombre }}</strong> - Ciclo {{ curso.ciclo_lectivo }}</p>
        </div>
    </div>

    <!-- Selector de Fecha -->
    <div class="date-selector">
        <form method="get">
            <label for="fecha">Seleccionar Fecha:</label>
            <input type="date" name="fecha" value="{{ fecha|date:'Y-m-d' }}" onchange="this.form.submit()">
        </form>
    </div>

    <!-- Formulario de Asistencia -->
    <form method="post">
        {% csrf_token %}
        <table class="table-list">
            <thead>
                <tr>
                    <th>Alumno</th>
                    <th>Presente</th>
                    <th>Ausente</th>
                    <th>Justificado</th>
                </tr>
            </thead>
            <tbody>
                {% for inscripcion in inscripciones %}
                <tr>
                    <td>{{ inscripcion.alumno.apellido }}, {{ inscripcion.alumno.nombre }}</td>
                    {% with estado=estado_asistencia|get_item:inscripcion.pk|default:'Ausente' %}
                    <td><input type="radio" name="asistencia-{{ inscripcion.pk }}" value="Presente" {% if estado == 'Presente' %}checked{% endif %}></td>
                    <td><input type="radio" name="asistencia-{{ inscripcion.pk }}" value="Ausente" {% if estado == 'Ausente' %}checked{% endif %}></td>
                    <td><input type="radio" name="asistencia-{{ inscripcion.pk }}" value="Justificado" {% if estado == 'Justificado' %}checked{% endif %}></td>
                    {% endwith %}
                </tr>
                {% empty %}
                <tr><td colspan="4">No hay alumnos inscriptos en este curso.</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="form-actions" style="margin-top: 20px;">
            <button type="submit" class="btn-primary">Guardar Asistencias</button>
            <a href="{% url 'academico:curso_list' materia_pk=curso.materia.pk %}" class="btn-secondary">← Volver a Cursos</a>
        </div>
    </form>
</div>
{% endblock %}